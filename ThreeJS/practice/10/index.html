<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>three.js</title>
</head>
<style type="text/css">
  * {
    margin: 0;
    padding: 0
  }

  html,
  body {
    height: 100%;
    width: 100%;
    overflow: hidden;
  }
</style>

<body>
  <div id="app"></div>
</body>

<script src="../../exemple/libs/three.js" type="text/javascript" charset="utf-8"></script>
<script src="../../exemple/libs/stats.js" type="text/javascript" charset="utf-8"></script>
<script src="../../exemple/libs/dat.gui.js" type="text/javascript" charset="utf-8"></script>
<script src="../../lib/jquery-1.7.2.js" type="text/javascript" charset="utf-8"></script>
<script>
  // once everything is loaded, we run our Three.js stuff.
  var scene, camera, plane;

  function init() {
    scene = new THREE.Scene();

    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
    // create a render and set the size
    var renderer = new THREE.WebGLRenderer();
    renderer.setClearColor(new THREE.Color(0x000000, 1.0));
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMapEnabled = true;

    var planeGeometry = new THREE.PlaneGeometry(50, 50, 1, 1);
    // var planeGeometry = new THREE.BoxGeometry(15, 15, 15);
    // var planeMaterial = new THREE.MeshLambertMaterial({
    //   color: 0x0000ff
    // });



    // var t = THREE.ImageUtils.loadTexture("../../exemple/assets/textures/general/plaster.jpg");
    // var m = THREE.ImageUtils.loadTexture("../../exemple/assets/textures/general/plaster-normal.jpg");
    var t = THREE.ImageUtils.loadTexture("./textures/map-texture.448897a4.jpg");
    var m = THREE.ImageUtils.loadTexture("./textures/map-height.a133515f.jpg");
    var mat2 = new THREE.MeshPhongMaterial();
    mat2.map = t;
    // mat2.bumpMap = m;
    // mat2.normalScale.set(1, 1);
    // mat2.bumpScale = 0.2

    plane = new THREE.Mesh(planeGeometry, mat2);
    plane.receiveShadow = true;
    plane.castShadow = true;
    // rotate and position the plane
    // plane.rotation.x = -0.25 * Math.PI;
    plane.position.x = 0;
    plane.position.y = 0;
    plane.position.z = 0;

    // add the plane to the scene
    scene.add(plane);

    // create a cube
    var cubeGeometry = new THREE.BoxGeometry(0.1, 0.1, 0.1);
    var cubeMaterial = new THREE.MeshLambertMaterial({
      color: 0xff0000
    });
    var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
    cube.castShadow = true;
    // cube.rotation.x = -0.3 * Math.PI;
    // cube.rotation.y = -0.3 * Math.PI;

    // position the cube
    cube.position.x = 0;
    cube.position.y = 0;
    cube.position.z = 0;

    // add the cube to the scene
    scene.add(cube);


    camera.position.x = 0;
    camera.position.y = -2;
    camera.position.z = 10;
    camera.lookAt(new THREE.Vector3(0, 0, 0));

    // add subtle ambient lighting
    var ambiColor = "#000000";
    var ambientLight = new THREE.AmbientLight(ambiColor);
    scene.add(ambientLight);

    var spotLight = new THREE.SpotLight(0xeeeeee, 4, 90);
    spotLight.position.set(0, 0, 70);
    // spotLight.castShadow = true;
    scene.add(spotLight);
    // add the output of the renderer to the html element
    document.getElementById("app").appendChild(renderer.domElement);


    var controls = new function () {
      this.rotation = 1;
      this.handle = function (e) {
        // camera.position.x = 2 + (10*Math.cos(step));
        // camera.position.y = 2 + (10*Math.abs(Math.sin(step)));
        cube.position.set(0, e * 0.2, 0)
        camera.position.z = -e * 0.2 + 10
        camera.lookAt(cube.position)
      }

    }
    var gui = new dat.GUI();
    gui.add(controls, "rotation", -10, 10).onChange(controls.handle);


    var step = 10;
    var flag = 1;

    function render() { // render using requestAnimationFrame
      
      step += 0.1*flag 
      if(step>15){
        flag = -1
      }else if(step<-10){
        flag = 1
      }

      console.log(step)
      cube.position.set(0, step * 0.2, 0)
      camera.position.z = -step * 0.3 + 30
      camera.lookAt(cube.position)

      // camera.position.x = 2 + (10*Math.cos(step));
      // camera.position.y = 2 + (10*Math.abs(Math.sin(step)));
      // camera.lookAt(cube.position)
      requestAnimationFrame(render);
      renderer.render(scene, camera);
    }
    render();

  }

  window.onload = init
</script>

</html>